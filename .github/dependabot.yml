# Dependabot configuration
# https://docs.github.com/en/code-security/dependabot/dependabot-version-updates
#
# Strategy: Two-tier approach
# - Tier 1 (auto-merge): Patch and minor updates via dependabot-auto-merge.yml
# - Tier 2 (manual review): Major versions, Docker base images, GitHub Actions

version: 2
updates:
  # GitHub Actions (manual review - infrastructure changes)
  - package-ecosystem: 'github-actions'
    directory: '/'
    schedule:
      interval: 'weekly'
      day: 'monday'
    commit-message:
      prefix: 'ci'
    labels:
      - 'dependencies'
      - 'github-actions'
    groups:
      github-actions:
        patterns:
          - '*'

  # Go modules (contract tests)
  - package-ecosystem: 'gomod'
    directory: '/'
    schedule:
      interval: 'weekly'
      day: 'monday'
    commit-message:
      prefix: 'deps(go)'
    labels:
      - 'dependencies'
      - 'go'
    groups:
      go-deps:
        patterns:
          - '*'

  # Go service
  - package-ecosystem: 'gomod'
    directory: '/services/go-gin'
    schedule:
      interval: 'weekly'
      day: 'monday'
    commit-message:
      prefix: 'deps(go-gin)'
    labels:
      - 'dependencies'
      - 'go'
    groups:
      go-gin-deps:
        patterns:
          - '*'

  # Python services
  - package-ecosystem: 'pip'
    directory: '/services/python-django'
    schedule:
      interval: 'weekly'
      day: 'monday'
    commit-message:
      prefix: 'deps(django)'
    labels:
      - 'dependencies'
      - 'python'
    groups:
      django-deps:
        patterns:
          - '*'

  - package-ecosystem: 'pip'
    directory: '/services/python-flask'
    schedule:
      interval: 'weekly'
      day: 'monday'
    commit-message:
      prefix: 'deps(flask)'
    labels:
      - 'dependencies'
      - 'python'
    groups:
      flask-deps:
        patterns:
          - '*'

  # Node.js services
  - package-ecosystem: 'npm'
    directory: '/services/node-express'
    schedule:
      interval: 'weekly'
      day: 'monday'
    commit-message:
      prefix: 'deps(express)'
    labels:
      - 'dependencies'
      - 'javascript'
    groups:
      express-deps:
        patterns:
          - '*'

  - package-ecosystem: 'npm'
    directory: '/services/typescript-fastify'
    schedule:
      interval: 'weekly'
      day: 'monday'
    commit-message:
      prefix: 'deps(fastify)'
    labels:
      - 'dependencies'
      - 'typescript'
    groups:
      fastify-deps:
        patterns:
          - '*'

  # Java services
  - package-ecosystem: 'maven'
    directory: '/services/java-spring4'
    schedule:
      interval: 'weekly'
      day: 'monday'
    commit-message:
      prefix: 'deps(spring4)'
    labels:
      - 'dependencies'
      - 'java'
    groups:
      spring4-deps:
        patterns:
          - '*'
    ignore:
      - dependency-name: 'org.springframework.boot:spring-boot-starter-parent'
        versions: ['>=5.0.0']

  - package-ecosystem: 'maven'
    directory: '/services/java-spring3'
    schedule:
      interval: 'weekly'
      day: 'monday'
    commit-message:
      prefix: 'deps(spring3)'
    labels:
      - 'dependencies'
      - 'java'
    groups:
      spring3-deps:
        patterns:
          - '*'
    ignore:
      - dependency-name: 'org.springframework.boot:spring-boot-starter-parent'
        versions: ['>=4.0.0']

  - package-ecosystem: 'maven'
    directory: '/services/java-spring2'
    schedule:
      interval: 'weekly'
      day: 'monday'
    commit-message:
      prefix: 'deps(spring2)'
    labels:
      - 'dependencies'
      - 'java'
    groups:
      spring2-deps:
        patterns:
          - '*'
    ignore:
      - dependency-name: 'org.springframework.boot:spring-boot-starter-parent'
        versions: ['>=3.0.0']

  - package-ecosystem: 'maven'
    directory: '/services/java-micronaut'
    schedule:
      interval: 'weekly'
      day: 'monday'
    commit-message:
      prefix: 'deps(micronaut)'
    labels:
      - 'dependencies'
      - 'java'
    groups:
      micronaut-deps:
        patterns:
          - '*'

  - package-ecosystem: 'maven'
    directory: '/services/java-quarkus'
    schedule:
      interval: 'weekly'
      day: 'monday'
    commit-message:
      prefix: 'deps(quarkus)'
    labels:
      - 'dependencies'
      - 'java'
    groups:
      quarkus-deps:
        patterns:
          - '*'

  - package-ecosystem: 'maven'
    directory: '/services/java-quarkus-native'
    schedule:
      interval: 'weekly'
      day: 'monday'
    commit-message:
      prefix: 'deps(quarkus-native)'
    labels:
      - 'dependencies'
      - 'java'
    groups:
      quarkus-native-deps:
        patterns:
          - '*'

  # Kotlin service
  - package-ecosystem: 'gradle'
    directory: '/services/kotlin-ktor'
    schedule:
      interval: 'weekly'
      day: 'monday'
    commit-message:
      prefix: 'deps(ktor)'
    labels:
      - 'dependencies'
      - 'kotlin'
    groups:
      ktor-deps:
        patterns:
          - '*'

  # Scala service
  - package-ecosystem: 'gradle'
    directory: '/services/scala-play'
    schedule:
      interval: 'weekly'
      day: 'monday'
    commit-message:
      prefix: 'deps(play)'
    labels:
      - 'dependencies'
      - 'scala'
    groups:
      play-deps:
        patterns:
          - '*'

  # Rust service
  - package-ecosystem: 'cargo'
    directory: '/services/rust-actix'
    schedule:
      interval: 'weekly'
      day: 'monday'
    commit-message:
      prefix: 'deps(actix)'
    labels:
      - 'dependencies'
      - 'rust'
    groups:
      actix-deps:
        patterns:
          - '*'

  # .NET services
  - package-ecosystem: 'nuget'
    directory: '/services/csharp-aspnet'
    schedule:
      interval: 'weekly'
      day: 'monday'
    commit-message:
      prefix: 'deps(aspnet)'
    labels:
      - 'dependencies'
      - 'csharp'
    groups:
      aspnet-deps:
        patterns:
          - '*'

  - package-ecosystem: 'nuget'
    directory: '/services/csharp-aspnet-native'
    schedule:
      interval: 'weekly'
      day: 'monday'
    commit-message:
      prefix: 'deps(aspnet-native)'
    labels:
      - 'dependencies'
      - 'csharp'
    groups:
      aspnet-native-deps:
        patterns:
          - '*'

  # Ruby service
  - package-ecosystem: 'bundler'
    directory: '/services/ruby-rails'
    schedule:
      interval: 'weekly'
      day: 'monday'
    commit-message:
      prefix: 'deps(rails)'
    labels:
      - 'dependencies'
      - 'ruby'
    groups:
      rails-deps:
        patterns:
          - '*'

  # PHP service
  - package-ecosystem: 'composer'
    directory: '/services/php-laravel'
    schedule:
      interval: 'weekly'
      day: 'monday'
    commit-message:
      prefix: 'deps(laravel)'
    labels:
      - 'dependencies'
      - 'php'
    groups:
      laravel-deps:
        patterns:
          - '*'

  # C++ service (vcpkg)
  - package-ecosystem: 'docker'
    directory: '/services/cpp-drogon'
    schedule:
      interval: 'weekly'
      day: 'monday'
    commit-message:
      prefix: 'deps(drogon)'
    labels:
      - 'dependencies'
      - 'cpp'

  # Docker base images (manual review - infrastructure changes)
  - package-ecosystem: 'docker'
    directory: '/'
    schedule:
      interval: 'weekly'
      day: 'monday'
    commit-message:
      prefix: 'deps(docker)'
    labels:
      - 'dependencies'
      - 'docker'
    ignore:
      # Pin Ruby to 3.x until grpc gem has pre-built binaries for Ruby 4.0
      # Without this, builds take 15+ minutes compiling grpc from source
      - dependency-name: 'ruby'
        versions: ['>=4.0.0']

  # Terraform
  - package-ecosystem: 'terraform'
    directory: '/terraform'
    schedule:
      interval: 'weekly'
      day: 'monday'
    commit-message:
      prefix: 'deps(terraform)'
    labels:
      - 'dependencies'
      - 'terraform'
    groups:
      terraform-deps:
        patterns:
          - '*'
